<div class="car-details" *ngIf="car">
  <div class="container">

    <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
    <div class="car-header">
      <div class="car-title-section">
        <h1>{{ car.brand }} {{ car.model }}</h1>
        <div class="car-rating" *ngIf="car.rating">
          <div class="stars">
            <i class="fas fa-star" *ngFor="let star of [].constructor(car.rating); let i = index"></i>
            <i class="far fa-star" *ngFor="let star of [].constructor(5 - car.rating)"></i>
          </div>
          <span class="rating-value">{{ car.rating }}/5</span>
        </div>
      </div>
      <div class="car-badges">
        <span class="year-badge">{{ car.year }}</span>
        <span class="category-badge" *ngIf="car.category">{{ car.category }}</span>
        <span class="feature-badge" *ngIf="car.featured">{{ translationService.translate('featured') }}</span>
      </div>
    </div>
    
    <!-- ÙˆØµÙ Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
    <div class="car-description" *ngIf="car.description">
      <h3>{{ translationService.translate('description') }}</h3>
      <p>{{ car.description }}</p>
    </div>

    <!-- Ù…Ø¹Ø±Ø¶ ØµÙˆØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
    <div class="car-gallery">
      <div class="main-image-container">
        <img [src]="currentImage || car.image" alt="{{ car.model }}" class="car-img" />
        <div class="image-overlay">
          <div class="price-tag">
            {{ car.pricePerDay }} MAD
            <span>{{ translationService.translate('car.pricePerDay') }}</span>
          </div>
        </div>
      </div>
      
      <!-- Ù…ØµØºØ±Ø§Øª Ø§Ù„ØµÙˆØ± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© -->
      <div class="thumbnail-container" *ngIf="car.additionalImages && car.additionalImages.length > 0">
        <div class="thumbnail" 
             *ngFor="let img of getAllImages()" 
             [class.active]="currentImage === img"
             (click)="currentImage = img">
          <img [src]="img" alt="{{ car.model }}" />
        </div>
      </div>
    </div>

    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
    <div class="car-info">
      <div class="info-grid">
        <div class="info-item">
          <i class="fas fa-tachometer-alt"></i>
          <span>{{ translationService.translate('car.plate') }}: {{ car.plateNumber }}</span>
        </div>
        <div class="info-item">
          <i class="fas fa-gas-pump"></i>
          <span>{{ translationService.translate('fuelType') }}: {{ car.fuel }}</span>
        </div>
        <div class="info-item">
          <i class="fas fa-cogs"></i>
          <span>{{ translationService.translate('carType') }}: {{ car.type }}</span>
        </div>
        <div class="info-item">
          <i class="fas fa-calendar-alt"></i>
          <span>
            {{ isCurrentlyAvailable
              ? translationService.translate('carDetails.available')
              : translationService.translate('car.notAvailable')
            }}
          </span>
        </div>
        <div class="info-item">
          <i class="fas fa-users"></i>
          <span>{{ translationService.translate('seats') }}: {{ car.seats || '5' }}</span>
        </div>
        <div class="info-item">
          <i class="fas fa-suitcase"></i>
          <span>{{ translationService.translate('luggage') }}: {{ car.luggage || '2' }}</span>
        </div>
        <div class="info-item">
          <i class="fas fa-car-side"></i>
          <span>{{ translationService.translate('transmission') }}: {{ car.transmission || 'Manual' }}</span>
        </div>
        <div class="info-item">
          <i class="fas fa-wind"></i>
          <span>{{ translationService.translate('airConditioning') }}: {{ car.airConditioning ? translationService.translate('yes') : translationService.translate('no') }}</span>
        </div>
      </div>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® -->
    <div class="rental-form">
      <h3>{{ translationService.translate('car.selectDates') }}</h3>

      <div class="date-inputs">
        <div class="date-input-group">
          <label for="start-date">{{ translationService.translate('car.startDate') }}</label>
         <input
  type="datetime-local"
  id="start-date"
  [(ngModel)]="startDate"
  (change)="checkDatesOverlap()"
/>
        </div>

        <div class="date-input-group">
          <label for="end-date">{{ translationService.translate('endDate') }}</label>
          <input
  type="datetime-local"
  id="end-date"
  [(ngModel)]="endDate"
  (change)="checkDatesOverlap()"
/>
        </div>
      </div>

      <!-- Ø§Ù„Ø³ÙŠØ§Ø±Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ù… -->
      <div *ngIf="!isCurrentlyAvailable && !startDate && !endDate" class="alert alert-warning mt-3">
        <i class="fas fa-exclamation-triangle"></i>
        <span>
          {{ translationService.translate('carStatus.booked') }}
        </span>
        <span *ngIf="getLastBookingEndDate()" class="d-block mt-2">
          ðŸ“… {{ translationService.translate('carStatus.availableAfter') }}:
          {{ getFormattedAvailableDate() }}
        </span>
      </div>

      <!-- Ø§Ù„Ø³ÙŠØ§Ø±Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ù„Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© -->
      <div *ngIf="!isCarAvailable && startDate && endDate" class="alert alert-warning mt-3">
        <i class="fas fa-exclamation-triangle"></i>
        {{ translationService.translate('carStatus.booked') }}

        <span *ngIf="nextAvailableDate" class="d-block mt-2">
          ðŸ“… {{ translationService.translate('carStatus.availableAfter') }}:
          {{ nextAvailableDate | date:'dd/MM/yyyy' }}
        </span>
      </div>

      <!-- Ø²Ø± Ø§Ù„Ø­Ø¬Ø² -->
      <div class="price-summary" *ngIf="startDate && endDate && isCarAvailable">
        <div class="price-item">
          <span>{{ translationService.translate('dailyRate') }}:</span>
          <span>{{ car.pricePerDay }} {{ translationService.translate('currency.dh') }}</span>
        </div>
        <div class="price-item">
          <span>{{ translationService.translate('rentalDuration') }}:</span>
          <span>{{ calculateRentalDays() }} {{ translationService.translate('days') }}</span>
        </div>
        <div class="price-item total">
          <span>{{ translationService.translate('totalPrice') }}:</span>
          <span>{{ calculateTotalPrice() }} {{ translationService.translate('currency.dh') }}</span>
        </div>
      </div>
      
      <button
        (click)="rentCar()"
        class="btn btn-primary"
        [disabled]="!isCurrentlyAvailable || (!isCarAvailable && startDate && endDate)"
      >
        <i class="fas fa-car"></i>
        {{ translationService.translate('book') }}
      </button>

    </div>
  </div>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
<div *ngIf="!car" class="loading">
  <div class="spinner"></div>
  <p>{{ translationService.translate('loading') }}</p>
</div>
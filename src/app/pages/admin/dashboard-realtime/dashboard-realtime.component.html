<div class="container-fluid p-4 bg-light min-vh-100">
  <div class="d-flex justify-content-between align-items-center mb-4 animate-up">
    <div>
      <h2 class="fw-bold text-dark mb-1">{{ 'Admin Dashboard' | translate }}</h2>
      <p class="text-muted mb-0">{{ 'Overview of system performance and management' | translate }}</p>
    </div>
    <div class="clock bg-white px-3 py-2 rounded-pill shadow-sm text-primary fw-bold">
      <i class="far fa-clock me-2"></i>
      <span>{{ currentTime | date:'HH:mm:ss' }}</span>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="row g-4 mb-4 animate-up delay-1">
    <div class="col-md-4">
      <div class="card border-0 shadow-sm h-100 hover-lift">
        <div class="card-body p-4 d-flex align-items-center">
          <div class="icon-box bg-primary bg-opacity-10 text-primary rounded-circle d-flex align-items-center justify-content-center me-4" style="width: 60px; height: 60px;">
            <i class="fas fa-car fa-2x"></i>
          </div>
          <div>
            <h6 class="text-muted mb-1">{{ 'totalCars' | translate }}</h6>
            <h2 class="fw-bold mb-0">{{ stats.totalCars }}</h2>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card border-0 shadow-sm h-100 hover-lift">
        <div class="card-body p-4 d-flex align-items-center">
          <div class="icon-box bg-warning bg-opacity-10 text-warning rounded-circle d-flex align-items-center justify-content-center me-4" style="width: 60px; height: 60px;">
            <i class="fas fa-calendar-check fa-2x"></i>
          </div>
          <div>
            <h6 class="text-muted mb-1">{{ 'activeBookings' | translate }}</h6>
            <h2 class="fw-bold mb-0">{{ stats.activeBookings }}</h2>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card border-0 shadow-sm h-100 hover-lift">
        <div class="card-body p-4 d-flex align-items-center">
          <div class="icon-box bg-success bg-opacity-10 text-success rounded-circle d-flex align-items-center justify-content-center me-4" style="width: 60px; height: 60px;">
            <i class="fas fa-check-circle fa-2x"></i>
          </div>
          <div>
            <h6 class="text-muted mb-1">{{ 'availableCars' | translate }}</h6>
            <h2 class="fw-bold mb-0">{{ stats.availableCars }}</h2>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Actions & Notifications -->
  <div class="row g-4 mb-4 animate-up delay-2">
    <div class="col-md-12">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-0 py-3 d-flex justify-content-between align-items-center">
          <h5 class="fw-bold mb-0 text-primary">
            <i class="fas fa-bell me-2"></i> {{ 'realtimeNotifications' | translate }}
          </h5>
          <div class="btn-group">
            <button class="btn btn-sm btn-outline-success rounded-pill me-2" (click)="syncCarStatus()">
              <i class="fas fa-sync me-1"></i> {{ 'Sync Car Status' | translate }}
            </button>
            <button class="btn btn-sm btn-outline-primary rounded-pill me-2" (click)="refreshData()">
              <i class="fas fa-sync-alt me-1"></i> {{ 'refreshData' | translate }}
            </button>
            <button class="btn btn-sm btn-outline-danger rounded-pill" (click)="clearNotifications()">
              <i class="fas fa-trash me-1"></i> {{ 'clearAll' | translate }}
            </button>
          </div>
        </div>
        <div class="card-body">
          <div *ngIf="loading" class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">{{ 'loading' | translate }}</span>
            </div>
          </div>
          
          <div class="notification-container" *ngIf="!loading">
            <div *ngIf="notifications.length === 0" class="text-center text-muted py-4">
              <i class="fas fa-check-circle fa-3x mb-3 opacity-25"></i>
              <p>{{ 'noNotifications' | translate }}</p>
            </div>

            <div class="notification-list">
              <div *ngFor="let notification of notifications" 
                   class="alert alert-{{ notification.type }} border-0 shadow-sm d-flex align-items-center mb-2 rounded-3">
                <div class="notification-icon me-3">
                  <i class="fas {{ notification.icon }} fa-lg"></i>
                </div>
                <div class="notification-content flex-grow-1">
                  <div class="fw-bold">{{ notification.message }}</div>
                  <small class="text-muted">
                    <i class="far fa-clock me-1"></i>
                    {{ getTimeAgo(notification.timestamp) }}
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Cars Table -->
  <div class="row mb-4 animate-up delay-2">
    <div class="col-md-12">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-0 py-3 d-flex justify-content-between align-items-center">
          <h5 class="fw-bold mb-0">
            <i class="fas fa-car me-2 text-primary"></i> {{ 'carsList' | translate }}
          </h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
              <thead class="bg-light">
                <tr>
                  <th class="ps-4">{{ 'image' | translate }}</th>
                  <th>{{ 'brand' | translate }}</th>
                  <th>{{ 'model' | translate }}</th>
                  <th>{{ 'plateNumber' | translate }}</th>
                  <th>{{ 'pricePerDay' | translate }}</th>
                  <th>{{ 'status' | translate }}</th>
                  <th class="text-end pe-4">{{ 'actions' | translate }}</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let car of cars">
                  <td class="ps-4">
                    <img *ngIf="car.image" [src]="car.image" [alt]="car.brand" class="rounded shadow-sm" style="width: 50px; height: 40px; object-fit: cover;">
                    <div *ngIf="!car.image" class="bg-light rounded d-flex align-items-center justify-content-center text-muted" style="width: 50px; height: 40px;">
                      <i class="fas fa-car"></i>
                    </div>
                  </td>
                  <td class="fw-bold">{{ car.brand }}</td>
                  <td>{{ car.model }}</td>
                  <td><span class="badge bg-light text-dark border">{{ car.plateNumber }}</span></td>
                  <td class="fw-bold text-primary">{{ car.pricePerDay }} {{ 'currency.dh' | translate }}</td>
                  <td>
                    <span class="badge rounded-pill" [class.bg-success]="car.available" [class.bg-danger]="!car.available">
                      {{ car.available ? ('available' | translate) : ('rented' | translate) }}
                    </span>
                  </td>
                  <td class="text-end pe-4">
                    <div class="btn-group">
                      <a routerLink="/edit-car/{{car._id}}" class="btn btn-sm btn-light text-primary" title="Edit">
                        <i class="fas fa-edit"></i>
                      </a>
                      <button class="btn btn-sm btn-light text-danger" (click)="deleteCar(car._id)" title="Delete">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Users Table -->
  <div class="row mb-4 animate-up delay-3">
    <div class="col-md-12">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-0 py-3 d-flex justify-content-between align-items-center">
          <h5 class="fw-bold mb-0">
            <i class="fas fa-users me-2 text-primary"></i> {{ 'usersList' | translate }}
          </h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
              <thead class="bg-light">
                <tr>
                  <th class="ps-4">{{ 'name' | translate }}</th>
                  <th>{{ 'email' | translate }}</th>
                  <th>{{ 'nationalId' | translate }}</th>
                  <th>{{ 'cinImages' | translate }}</th>
                  <th>{{ 'role' | translate }}</th>
                  <th class="text-end pe-4">{{ 'actions' | translate }}</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let user of users">
                  <td class="ps-4 fw-bold">{{ user.name }}</td>
                  <td>{{ user.email }}</td>
                  <td><span class="badge bg-light text-dark border">{{ user.nationalId }}</span></td>
                  <td>
                    <div class="d-flex gap-2">
                      <a *ngIf="user.cinFront" [href]="user.cinFront" target="_blank" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-id-card"></i> {{ 'Front' | translate }}
                      </a>
                      <a *ngIf="user.cinBack" [href]="user.cinBack" target="_blank" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-id-card"></i> {{ 'Back' | translate }}
                      </a>
                      <span *ngIf="!user.cinFront && !user.cinBack" class="text-muted small">{{ 'No images' | translate }}</span>
                    </div>
                  </td>
                  <td>
                    <span class="badge rounded-pill" [class.bg-primary]="user.role === 'admin'" [class.bg-secondary]="user.role === 'user'">
                      {{ user.role }}
                    </span>
                  </td>
                  <td class="text-end pe-4">
                    <button class="btn btn-sm btn-light text-danger" 
                            (click)="deleteUser(user._id)" 
                            title="Delete User">
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bookings Table -->
  <div class="row mb-4 animate-up delay-3">
    <div class="col-md-12">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-0 py-3 d-flex justify-content-between align-items-center">
          <h5 class="fw-bold mb-0">
            <i class="fas fa-calendar-check me-2 text-primary"></i> {{ 'bookingsList' | translate }}
          </h5>
          <button class="btn btn-sm btn-outline-info rounded-pill" (click)="refreshBookings()">
            <i class="fas fa-sync-alt me-1"></i> {{ 'refresh' | translate }}
          </button>
        </div>
        <div class="card-body p-0">
          <div *ngIf="loading" class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">{{ 'loading' | translate }}</span>
            </div>
          </div>
          <div class="table-responsive" *ngIf="!loading">
            <table class="table table-hover align-middle mb-0">
              <thead class="bg-light">
                <tr>
                  <th class="ps-4">{{ 'car' | translate }}</th>
                  <th>{{ 'customer' | translate }}</th>
                  <th>{{ 'nationalId' | translate }}</th>
                  <th>{{ 'startDate' | translate }}</th>  
                  <th>{{ 'endDate' | translate }}</th>
                  <th>{{ 'totalPrice' | translate }}</th>
                  <th>{{ 'status' | translate }}</th>
                  <th class="text-end pe-4">{{ 'actions' | translate }}</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let booking of bookings">
                  <td class="ps-4 fw-bold">{{ booking.carId?.brand }} {{ booking.carId?.model }}</td>
                  <td>
                    <div class="d-flex align-items-center">
                      <div class="avatar-sm bg-primary text-white rounded-circle me-2 d-flex align-items-center justify-content-center" style="width: 30px; height: 30px; font-size: 0.8rem;">
                        {{ booking.userId?.name?.charAt(0) || 'U' }}
                      </div>
                      {{ booking.userId?.name }}
                    </div>
                  </td>
                  <td><span class="badge bg-light text-dark border">{{ booking.userId?.nationalId }}</span></td>
                  <td>{{ booking.startDate | date:'dd/MM/yyyy HH:mm' }}</td>
                  <td>{{ booking.endDate | date:'dd/MM/yyyy HH:mm' }}</td>
                  <td>
                    <div class="fw-bold text-primary">{{ calculateTotalPrice(booking) }} {{ 'currency.dh' | translate }}</div>
                  </td>
                  <td>
                    <span class="badge rounded-pill" 
                          [class.bg-success]="booking.status === 'confirmed'"
                          [class.bg-warning]="booking.status === 'pending'"
                          [class.bg-danger]="booking.status === 'cancelled'">
                      {{ booking.status === 'confirmed' ? ('confirmed' | translate) : booking.status === 'pending' ? ('pending' | translate) : ('cancelled' | translate) }}
                    </span>
                  </td>
                  <td class="text-end pe-4">
                    <div class="btn-group">
                      <button class="btn btn-sm btn-outline-warning rounded-pill me-2" 
                              (click)="cancelBooking(booking._id)"
                              *ngIf="booking.status !== 'cancelled'"
                              title="Cancel Booking">
                        <i class="fas fa-times me-1"></i> {{ 'cancel' | translate }}
                      </button>   
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
            <div *ngIf="bookings.length === 0" class="text-center py-5">
              <div class="icon-box bg-light text-muted rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 80px; height: 80px;">
                <i class="fas fa-calendar-times fa-2x"></i>
              </div>
              <h5 class="text-muted">{{ 'noBookings' | translate }}</h5>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
